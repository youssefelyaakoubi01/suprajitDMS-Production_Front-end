<div class="dashboard-container">
    <!-- Loading Overlay -->
    <div *ngIf="isLoading" class="loading-overlay">
        <p-progressSpinner></p-progressSpinner>
    </div>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div>
            <h1 class="dashboard-title">Dashboard</h1>
            <p class="dashboard-subtitle">Real-time production monitoring</p>
        </div>
        <div class="header-actions">
            <p-datepicker
                [(ngModel)]="selectedDate"
                (onSelect)="onDateChange()"
                [showIcon]="true"
                [maxDate]="today"
                dateFormat="dd/mm/yy"
                [style]="{'width': '150px'}"
                styleClass="date-picker">
            </p-datepicker>
            <p-select
                [options]="projectOptions"
                [(ngModel)]="selectedProjectId"
                (onChange)="onProjectChange()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Project"
                [style]="{'min-width': '200px'}"
                styleClass="project-dropdown">
            </p-select>
            <span class="last-updated">Last updated: {{ lastUpdated | date:'HH:mm:ss' }}</span>
            <p-button icon="pi pi-refresh" [rounded]="true" [text]="true" (click)="loadDashboardData()"></p-button>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
        <app-kpi-card *ngFor="let kpi of kpis" [kpi]="kpi"></app-kpi-card>
    </div>

    <!-- Production Lines Status -->
    <p-card styleClass="production-lines-card">
        <ng-template pTemplate="header">
            <div class="card-header">
                <h2 class="card-title">Production Lines Status</h2>
                <p-tag [value]="productionLines.length + ' Lines'" severity="info"></p-tag>
            </div>
        </ng-template>

        <div class="production-lines-list">
            <app-production-line-card
                *ngFor="let line of productionLines"
                [line]="line"
                (lineClick)="onLineClick($event)">
            </app-production-line-card>
        </div>

        <div *ngIf="productionLines.length === 0" class="empty-state">
            <i class="pi pi-inbox empty-icon"></i>
            <p>No production lines available</p>
        </div>
    </p-card>

    <!-- Charts Row -->
    <div class="charts-grid">
        <!-- Output per Hour Chart -->
        <p-card styleClass="chart-card">
            <ng-template pTemplate="header">
                <div class="card-header">
                    <h3 class="card-title">Output / Hour</h3>
                </div>
            </ng-template>
            <div class="chart-container">
                <p-chart type="bar" [data]="outputChartData" [options]="chartOptions"></p-chart>
            </div>
        </p-card>

        <!-- Downtime Analysis Chart -->
        <p-card styleClass="chart-card">
            <ng-template pTemplate="header">
                <div class="card-header">
                    <h3 class="card-title">Downtime Analysis</h3>
                </div>
            </ng-template>
            <div class="chart-container">
                <p-chart type="bar" [data]="downtimeChartData" [options]="horizontalChartOptions"></p-chart>
            </div>
        </p-card>
    </div>
</div>

<p-toast position="top-right"></p-toast>
