<div class="maintenance-container">
    <div class="page-header">
        <div>
            <h1 class="page-title">Maintenance</h1>
            <p class="page-subtitle">Manage downtime and maintenance tickets</p>
        </div>
        <p-button label="Create Ticket" icon="pi pi-plus" (click)="openTicketDialog()"></p-button>
    </div>

    <!-- Summary Cards -->
    <div class="summary-grid">
        <p-card styleClass="summary-card danger">
            <div class="summary-content">
                <i class="pi pi-exclamation-circle summary-icon"></i>
                <div class="summary-info">
                    <span class="summary-value">{{ getOpenTickets() }}</span>
                    <span class="summary-label">Open Tickets</span>
                </div>
            </div>
        </p-card>
        <p-card styleClass="summary-card warning">
            <div class="summary-content">
                <i class="pi pi-wrench summary-icon"></i>
                <div class="summary-info">
                    <span class="summary-value">{{ getInProgressTickets() }}</span>
                    <span class="summary-label">In Progress</span>
                </div>
            </div>
        </p-card>
        <p-card styleClass="summary-card success">
            <div class="summary-content">
                <i class="pi pi-check-circle summary-icon"></i>
                <div class="summary-info">
                    <span class="summary-value">{{ getClosedTickets() }}</span>
                    <span class="summary-label">Closed Today</span>
                </div>
            </div>
        </p-card>
        <p-card styleClass="summary-card">
            <div class="summary-content">
                <i class="pi pi-list summary-icon"></i>
                <div class="summary-info">
                    <span class="summary-value">{{ tickets.length }}</span>
                    <span class="summary-label">Total Tickets</span>
                </div>
            </div>
        </p-card>
    </div>

    <!-- Tickets Table -->
    <p-card>
        <ng-template pTemplate="header">
            <div class="card-header">
                <h2 class="card-title">Maintenance Tickets</h2>
            </div>
        </ng-template>

        <p-table [value]="tickets" [paginator]="true" [rows]="10" [rowHover]="true">
            <ng-template pTemplate="header">
                <tr>
                    <th>Ticket #</th>
                    <th>Workstation</th>
                    <th>Cause</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-ticket>
                <tr>
                    <td><span class="font-semibold">#{{ ticket.DowntimeID }}</span></td>
                    <td>{{ ticket.WorkstationDT }}</td>
                    <td>{{ ticket.CauseDT }}</td>
                    <td><p-tag [value]="ticket.Priority" [severity]="getPrioritySeverity(ticket.Priority)"></p-tag></td>
                    <td><p-tag [value]="ticket.DowntimeStatus" [severity]="getStatusSeverity(ticket.DowntimeStatus)"></p-tag></td>
                    <td>{{ ticket.DateTimeDT | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>
                        <p-button icon="pi pi-eye" [rounded]="true" [text]="true"></p-button>
                        <p-button icon="pi pi-pencil" [rounded]="true" [text]="true"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
</div>

<p-dialog header="Create Maintenance Ticket" [(visible)]="showTicketDialog" [modal]="true" [style]="{ width: '500px' }">
    <div class="dialog-form">
        <div class="form-field">
            <label>Workstation</label>
            <p-select placeholder="Select workstation" [style]="{ width: '100%' }"></p-select>
        </div>
        <div class="form-field">
            <label>Priority</label>
            <p-select placeholder="Select priority" [style]="{ width: '100%' }"></p-select>
        </div>
        <div class="form-field">
            <label>Description</label>
            <textarea pTextarea rows="4" class="w-full"></textarea>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Cancel" [text]="true" (click)="closeTicketDialog()"></p-button>
        <p-button label="Create" (click)="closeTicketDialog()"></p-button>
    </ng-template>
</p-dialog>

<p-toast position="top-right"></p-toast>
